@model List<SEO_WEB.Models.Post>

@{
    Layout = "~/Views/Shared/_ClientLayout.cshtml";

    var areas = ViewBag.areas as List<SEO_WEB.Models.Area>;
    var postViewTop = ViewBag.postViewTop as List<SEO_WEB.Models.Post>;
    var cities = ViewBag.cities as List<SEO_WEB.Models.City>;
    var categories = ViewBag.categories as List<SEO_WEB.Models.Category>;
    var home = ViewBag.home as SEO_WEB.Models.Home;


    var i = 0;
    ViewBag.Title = home.Title;
}

@section meta{
    @Html.Partial("~/Views/Shared/_ClientMetasPartial.cshtml", home.Metas == null ? "" : home.Metas)
}



@section slide{
    @Html.Action("BackgroundPartial", "ClientHome")
}


<main class="wide space-y-20">
    <!-- top blog -->
    <section class="top-blogs text-gray-600 body-font">
        <div class="my-4 mx-auto">
            <div class="flex flex-wrap justify-between items-center w-full mb-6">
                <div>
                    <h3 class="sm:text-2xl text-2xl font-medium title-font mb-2 text-gray-900">Bài viết nổi bật</h3>
                    <div class="h-1 w-20 bg-lightBlue-700 rounded"></div>
                </div>
            </div>

            <div class="blogs-container flex flex-wrap gap-8">
                @foreach (var item in Model)
                {
                    var ci = cities.FirstOrDefault(c => c.ID == item.CityID).Alias;
                    var ca = categories.FirstOrDefault(c => c.ID == item.CategoryID).Alias;

                    <a href="/@ci/@ca/@item.Alias-@item.ID">
                        <div class="blog-card">
                            <div class="bg-gray-100">
                                <img class="h-40 w-full object-cover object-center mb-2" src="~/Assets/Admin/images/post/@item.Avatar" alt="@item.Alt" style="height: 12rem" />
                                <div class="p-4" style="height: 150px;">
                                    <h5 class="text-lg text-gray-900 font-medium title-font mb-2">@item.DisplayName</h5>
                                    <p class="leading-relaxed text-base">@item.Description</p>
                                </div>
                            </div>
                        </div>
                    </a>
                }
            </div>
        </div>
    </section>


    <!-- location -->
    <section class="text-gray-600 body-font">
        <div class="mx-auto">
            <div class="flex flex-col text-center w-full mb-10">
                <h1 class="sm:text-3xl text-2xl font-medium title-font mb-4 text-gray-900">Điểm đến nổi bật</h1>
                <p class="lg:w-2/3 mx-auto leading-relaxed text-base">Khám phá điểm đến tiếp theo cho hành trình tuyệt vời của bạn</p>
                <div class="flex justify-center space-x-4 my-4">
                    @foreach (var item in areas)
                    {
                        if (i++ == 0)
                        {
                            <button class="tab-btn btn btn-outline active btn-area" data-areaid="@item.ID">@item.DisplayName</button>
                        }
                        else
                        {
                            <button class="tab-btn btn btn-outline btn-area" data-areaid="@item.ID">@item.DisplayName</button>
                        }
                    }

                </div>
            </div>

            <div id="result-data"></div>

        </div>
    </section>
    <!-- end location -->
    <!-- quote -->
    <section class="text-gray-600 body-font">
        <div class="mx-auto">
            <div class="xl:w-1/2 lg:w-3/4 w-full mx-auto text-center">
                <i class="fas fa-quote-right text-2xl"></i>
                <p class="leading-relaxed text-lg">
                    Hai mươi năm về sau bạn sẽ hối hận về những gì bạn không làm hơn là những gì bạn làm. Vậy nên hãy tháo dây, nhổ neo ra khỏi bến đỗ an
                    toàn. Hãy để cánh buồn của bạn đón trọn lấy gió, thám hiểm, mơ mộng, khám phá.
                </p>
                <span class="inline-block h-1 w-10 rounded bg-lightBlue-600 mt-8 mb-6"></span>
            </div>
        </div>
    </section>
    <!-- end quote -->
    <!-- journey -->
    <section class="journey text-gray-600 body-font">
        <div class="flex flex-wrap justify-between items-center w-full mb-6">
            <div>
                <h3 class="sm:text-2xl text-2xl font-medium title-font mb-2 text-gray-900">Địa điểm nên ghé thăm</h3>
                <div class="h-1 w-20 bg-lightBlue-700 rounded"></div>
            </div>

            @*<div>
                    <p class="text-sm font-bold uppercase cursor-pointer hover:text-lightBlue-600">
                        <a href="#">Xem thêm</a> <i class="fas fa-angle-right text-base"></i>
                    </p>
                </div>*@
        </div>
        <div class="flex flex-wrap -m-4">
            @foreach (var item in postViewTop)
            {
                var ci = cities.FirstOrDefault(c => c.ID == item.CityID).Alias;
                var ca = categories.FirstOrDefault(c => c.ID == item.CategoryID).Alias;

                <div class="lg:w-1/3 sm:w-1/2 p-4">
                    <div class="flex relative cursor-default" style="height: 300px">
                        <img alt="@item.Alt" class="absolute inset-0 w-full h-full object-cover object-center" src="~/Assets/Admin/images/post/@item.Avatar" />
                        <div class="px-8 py-10 relative z-10 w-full border-4 border-gray-200 bg-white opacity-0 hover:opacity-100 transition-all duration-200">
                            <h5 class="title-font text-lg font-medium text-gray-900 mb-1">@item.DisplayName</h5>
                            <span class="tracking-widest text-sm title-font font-medium italic text-lightBlue-600 mb-1 cursor-pointer">#@(cities.FirstOrDefault(c=>c.ID==item.CityID).DisplayName)</span>
                            <p class="leading-relaxed">
                                @{
                                    var str = item.Description.Length > 160 ? item.Description.Substring(0, 160) + "..." : item.Description;
                                    try
                                    {
                                        str = str.Substring(0, str.LastIndexOf(' ')) + "...";
                                    }
                                    catch (Exception)
                                    {

                                    }
                                }

                                @str
                            </p>
                            <div class="flex flex-row-reverse">
                                <a href="/@ci/@ca/@item.Alias-@item.ID" class="fas fa-arrow-right text-xl mt-2 cursor-pointer hover:text-lightBlue-600"></a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>
    <!-- end jourey -->
</main>



<script>
    var obj = {
        init: function () {
            this.load();
            this.clickButtonArea();
        },
        load: function () {
            // lấy ra từ first
            this.loadAjaxByArea(1);
        },
        clickButtonArea: function () {
            $('body').on('click', '.btn-area', function () {
                var btns = $('.btn-area');
                let areaID = $(this).data('areaid');

                btns.removeClass('active');
                $(this).addClass('active');

                obj.loadAjaxByArea(areaID);
            })
        },
        loadAjaxByArea: function (areaID) {
            $.ajax({
                url: "/ClientHome/GetCitiesByAreaIDPartial/",
                data: { areaID: areaID },
                type: "GET",
                success: function (response) {
                    if (response) {
                        $("#result-data").empty();
                        $("#result-data").prepend(response);
                    }
                }
            })
        }
    }

    obj.init();
</script>

<script>
    const objHead = {
        init: function () {
            $('.btn-head-tab').removeClass('active');
            $('.btn-home').addClass('active');
        }
    }

    objHead.init();
</script>

@section script{
    <script src="~/Assets/Client/js/index.js"></script>
}
